<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:foo="http://servicemix.org/cheese/">

  <!-- the JBI container -->
  <container id="jbi" xmlns="http://servicemix.org/config/1.0">
    <activationSpecs>

      <!-- START SNIPPET: cache -->
      <activationSpec componentName="myService" service="foo:myService" destinationService="foo:myServiceImpl">
      	<component><bean xmlns="" class="org.apache.servicemix.components.cache.CacheComponent">
        <!-- we could use a JCache here if we want -->
        <property name="cache">
          <bean class="org.apache.servicemix.components.cache.LRUCache">
            <constructor-arg value="100"/>
          </bean>
        </property>

        <!-- lets define the cache key expression -->
        <property name="keyExpression">
          <bean class="org.apache.servicemix.expression.JaxenStringXPathExpression">
            <constructor-arg value="/*/@id"/>
          </bean>
        </property></bean>
      </component></activationSpec>
      <!-- END SNIPPET: cache -->

      <!-- START SNIPPET: groovy -->
      <activationSpec componentName="myServiceImpl" service="foo:myServiceImpl">
      <component>
       <bean xmlns="" class="org.apache.servicemix.components.groovy.GroovyComponent">
        <property name="scriptText">
          <value>
            <![CDATA[
if (bindings.counter == null) {
    bindings.counter = 1
}
else {
    ++bindings.counter
}

def date = new Date()

outMessage.bodyText = "<response counter='$bindings.counter' date='$date'></response>"
            ]]>
          </value>
        </property>
      </bean></component></activationSpec>
      <!-- END SNIPPET: groovy -->

    </activationSpecs>
  </container>


  <bean id="client" class="org.apache.servicemix.client.DefaultServiceMixClient">
    <constructor-arg ref="jbi"/>
  </bean>
</beans>
