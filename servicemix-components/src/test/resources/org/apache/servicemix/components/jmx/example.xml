<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:sm="http://servicemix.apache.org/config/1.0" 
	   xmlns:foo="http://servicemix.apache.org/cheese/">

  <!-- the JBI container -->
  <sm:container id="jbi" embedded="true" useMBeanServer="true" createMBeanServer="true">
    <sm:activationSpecs>
    
      <sm:activationSpec componentName="trace"
            			 endpoint="trace" 
            			 service="foo:trace">
        <sm:component>
        	<bean class="org.apache.servicemix.components.util.TraceComponent"/>
        </sm:component>
      </sm:activationSpec>

      <sm:activationSpec componentName="jmxMonitor"
                 		 service="foo:jmxMonitor" 
                 		 endpoint="jmxMonitor"
                 		 destinationService="foo:receiver">
        <sm:component>
         	<bean class="org.apache.servicemix.components.jmx.CounterMonitorComponent">
          		<property name="observedObjectName" value="org.apache.servicemix:container=defaultJBI,type=Component,name=trace,subtype=Statistics"/>
          		<property name="attributeName" value="inboundExchangeCount" />
          		<property name="threshold">
          		  <bean class="java.lang.Long">
    				<constructor-arg value="1"/>
          		  </bean>
          		</property>
          		<property name="offset">
          		  <bean class="java.lang.Long">
    				<constructor-arg value="1"/>
          		  </bean>
          		</property>
          		<property name="granularityPeriod" value="10" />
	        </bean>
	    </sm:component>
      </sm:activationSpec>

      <sm:activationSpec componentName="receiver"
            			 endpoint="receiver" 
            			 service="foo:receiver">
        <sm:component>
        	<bean class="org.apache.servicemix.tck.ReceiverComponent"/>
        </sm:component>
      </sm:activationSpec>

    </sm:activationSpecs>
  </sm:container>

  <bean id="client" class="org.apache.servicemix.client.DefaultServiceMixClient">
    <constructor-arg ref="jbi"/>
    <constructor-arg>
      <sm:activationSpec destinationService="foo:trace" />
    </constructor-arg>
  </bean>

</beans>
