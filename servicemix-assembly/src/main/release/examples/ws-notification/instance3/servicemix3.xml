<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:sm="http://servicemix.apache.org/config/1.0" 
	   xmlns:amq="http://activemq.org/config/1.0"
	   xmlns:test="http://servicemix.org/test"
	   xmlns:my="http://servicemix.apache.org/demo">

	<classpath>
	  <location>../lib/junit-3.8.1.jar</location>
	  <location>../lib/servicemix-wsn2005-3.0-SNAPSHOT.jar</location>
	  <location>../lib/servicemix-common-3.0-SNAPSHOT.jar</location>
	  <location>../lib/jaxb-api-2.0EA3.jar</location>
	  <location>../lib/jaxb-impl-2.0EA3.jar</location>
	  <location>../lib/xfire-jsr181-api-1.0-M1.jar</location>
	</classpath>
	   
  <!-- the JBI container -->
  <sm:container id="jbi" 
                name="wsn3"
                embedded="true" 
                MBeanServer="#mbeanServer">
    <sm:flow>
      <bean class="org.apache.servicemix.jbi.nmr.flow.jms.JMSFlow">
        <property name="connectionFactory" ref="connectionFactory" />
      </bean>
    </sm:flow>
    
    <sm:activationSpecs>

      <sm:activationSpec>
      	<sm:component>
      	  <bean class="org.apache.servicemix.wsn.spring.WSNSpringComponent">
      	    <property name="connectionFactory" ref="connectionFactory" />
      	  </bean>
        </sm:component>
      </sm:activationSpec>
      
      <sm:activationSpec service="test:publisher" endpoint="endpoint">
        <sm:component>
          <bean class="org.apache.servicemix.wsn.spring.PublisherComponent">
    	    <property name="topic" value="myTopic" />
          </bean>
        </sm:component>
      </sm:activationSpec>
      
      <sm:activationSpec destinationService="test:publisher" destinationEndpoint="endpoint">
        <sm:component>
          <bean class="org.apache.servicemix.components.quartz.QuartzComponent">
            <property name="triggers">
              <map>
                <entry>
                  <key>
                    <bean class="org.quartz.SimpleTrigger">
                      <property name="repeatInterval" value="2000"/>
                      <property name="repeatCount" value="20"/>
                    </bean>
                  </key>
                    <bean class="org.quartz.JobDetail">
                      <property name="name" value="My Example Job"/>
                      <property name="group" value="ServiceMix"/>
                    </bean>
                </entry>
              </map>
            </property>
          </bean>
        </sm:component>
      </sm:activationSpec>
      
		<sm:activationSpec componentName="trace" service="my:trace">
			<sm:component>
				<bean xmlns="http://xbean.org/schemas/spring/1.0"
					class="org.apache.servicemix.components.util.TraceComponent" />
			</sm:component>
		</sm:activationSpec>

    </sm:activationSpecs>
  </sm:container>
  
  <!-- JMX server and connector -->
  <bean id="mbeanServer" class="org.springframework.jmx.support.MBeanServerFactoryBean"/>
  
  <bean id="registry" class="mx4j.tools.naming.NamingService" init-method="start">
    <property name="port" value="1093"/>
  </bean>
  <bean id="serverConnector" class="org.springframework.jmx.support.ConnectorServerFactoryBean" depends-on="registry">
    <property name="objectName" value="connector:name=rmi"/>
    <property name="serviceUrl" value="service:jmx:rmi:///jndi/rmi://localhost:1093/jmxrmi"/>
    <property name="threaded" value="true"/>
    <property name="daemon" value="true"/>
  </bean>

  <bean id="connectionFactory" 
        class="org.apache.activemq.ActiveMQConnectionFactory">
    <property name="brokerURL" value="peer://localhost/wsnbroker3?broker.persistent=false" />
  </bean>
  
<!--
  <amq:broker id="broker" depends-on="mbeanServer" persistent="false">

    <amq:transportConnectors>
      <amq:transportConnector uri="tcp://localhost:61613" discoveryUri="multicast://default"/>
    </amq:transportConnectors>

  </amq:broker>
-->


</beans>
